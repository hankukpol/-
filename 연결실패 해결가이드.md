# 연결 테스트 실패 문제 해결 가이드

## 🔍 문제 원인

연결 테스트가 실패하는 이유는 **CORS (Cross-Origin Resource Sharing) 정책** 때문입니다.

- 로컬 파일 (`file:///`)에서 외부 URL (`https://script.google.com/...`)로 요청할 때 브라우저가 보안상의 이유로 차단합니다.
- 이는 정상적인 브라우저 보안 동작이며, HTML 파일이나 Code.gs에 문제가 있는 것이 아닙니다.

---

## ✅ 해결 방법

### 방법 1: Apps Script 배포 설정 확인 (가장 중요!)

Google Apps Script를 배포할 때 다음 설정을 **반드시** 확인하세요:

1. **Apps Script 편집기** → **배포** → **배포 관리** 클릭
2. 현재 배포의 **편집** (연필 아이콘) 클릭
3. **액세스 권한** 설정:
   - **다음 사용자로 실행**: **나**
   - **액세스 권한**: **모든 사용자** ⬅️ **중요!**
4. **배포** 버튼 클릭
5. 새로운 Web App URL 복사

> **참고**: "모든 사용자"로 설정해야 로컬 HTML 파일에서도 접근 가능합니다.

---

### 방법 2: 로컬 웹 서버 사용 (권장)

로컬 파일 대신 간단한 웹 서버를 통해 실행하면 CORS 문제를 완전히 해결할 수 있습니다.

#### Python이 설치되어 있는 경우:

```powershell
# HTML 파일이 있는 폴더로 이동
cd "c:\Users\kunry\Desktop\업무분장"

# Python 3 웹 서버 실행
python -m http.server 8000
```

그런 다음 브라우저에서 `http://localhost:8000/한국경찰학원 업무분장.html` 접속

#### Python이 없는 경우 - Live Server 사용:

1. VS Code 설치 (이미 설치되어 있다면 생략)
2. VS Code에서 "Live Server" 확장 프로그램 설치
3. HTML 파일을 VS Code에서 열기
4. 우클릭 → "Open with Live Server" 선택

---

### 방법 3: 브라우저 CORS 비활성화 (임시 방법, 권장하지 않음)

**⚠️ 주의**: 이 방법은 보안 위험이 있으므로 테스트 목적으로만 사용하세요.

#### Chrome의 경우:

```powershell
# 모든 Chrome 창을 닫은 후 실행
"C:\Program Files\Google\Chrome\Application\chrome.exe" --disable-web-security --user-data-dir="C:\temp\chrome_dev"
```

---

## 🧪 연결 테스트 방법

### 1단계: Apps Script 배포 확인

1. Google Sheets에서 **확장 프로그램** → **Apps Script** 열기
2. **배포** → **배포 관리** 클릭
3. Web App URL이 다음 형식인지 확인:
   ```
   https://script.google.com/macros/s/[긴 ID]/exec
   ```
4. URL 끝이 `/exec`로 끝나야 합니다 (`.../dev`가 아님)

### 2단계: 브라우저에서 직접 테스트

Web App URL을 복사하여 브라우저 주소창에 다음과 같이 입력:

```
https://script.google.com/macros/s/[당신의ID]/exec?action=getData
```

**예상 결과**:
- 성공: JSON 데이터가 표시됨 (예: `{"roles":[],"tasks":[],"principles":[]}`)
- 실패: 오류 메시지 표시

### 3단계: HTML 파일에서 연결

위의 브라우저 직접 테스트가 성공했다면:
- **방법 1** (Apps Script 배포 설정)을 다시 확인
- 또는 **방법 2** (로컬 웹 서버)를 사용하여 HTML 파일 실행

---

## 📝 요약

1. **Code.gs는 수정할 필요 없음** ✅
2. **Apps Script 배포 시 "모든 사용자" 권한 설정** ⬅️ 가장 중요!
3. **로컬 웹 서버 사용 권장** (Python 또는 Live Server)
4. **브라우저에서 직접 URL 테스트**로 Apps Script 작동 확인

이 가이드를 따라하시면 연결 테스트가 성공할 것입니다!
