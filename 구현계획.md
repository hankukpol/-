# Google Sheets 연동 구현 계획

## 목표
현재 LocalStorage 기반의 업무분장 시스템을 Google Sheets와 연동하여 여러 기기/브라우저에서 동일한 데이터를 공유할 수 있도록 개선합니다.

## User Review Required

> [!IMPORTANT]
> **Google 계정 필요**
> - Google Sheets와 Apps Script를 사용하므로 Google 계정이 필요합니다.
> - 배포 시 Web App URL을 HTML 파일에 입력해야 합니다.

> [!WARNING]
> **기존 LocalStorage 데이터 마이그레이션**
> - 기존에 LocalStorage에 저장된 데이터는 자동으로 Google Sheets로 마이그레이션됩니다.
> - 첫 실행 시 한 번만 수행되며, 이후에는 Google Sheets가 단일 진실 공급원(Single Source of Truth)이 됩니다.

## Proposed Changes

### 1. Google Apps Script 설정

#### [NEW] Google Sheets 생성
- **시트 구조**:
  - `roles` 시트: 직책 정보 (id, title, subtitle, icon, summary, kpi, main_duties, sub_duties, algorithm)
  - `tasks` 시트: 업무 목록 (id, category, task, main, sub)
  - `principles` 시트: 운영 원칙 (title, desc)

#### [NEW] Apps Script 코드
- **파일**: `Code.gs`
- **기능**:
  - `doGet()`: Web App 엔드포인트
  - `getData()`: 전체 데이터 조회
  - `saveData(data)`: 데이터 저장
  - `getRoles()`: 직책 정보 조회
  - `getTasks()`: 업무 목록 조회
  - `updateTask(task)`: 업무 수정
  - `deleteTask(id)`: 업무 삭제
  - `addTask(task)`: 업무 추가

---

### 2. HTML 파일 수정

#### [MODIFY] [한국경찰학원 업무분장.html](file:///c:/Users/kunry/Desktop/업무분장/한국경찰학원%20업무분장.html)

**변경 사항**:

1. **Google Sheets API 연동 코드 추가** (line 157 이후)
   - Web App URL 설정 변수 추가
   - API 호출 함수 구현 (`fetchFromSheets`, `saveToSheets`)

2. **데이터 초기화 로직 수정** (line 329-341)
   - Google Sheets에서 데이터 로드
   - LocalStorage는 캐시로만 사용
   - 첫 실행 시 LocalStorage → Sheets 마이그레이션

3. **데이터 저장 로직 수정** (line 343-345)
   - LocalStorage + Google Sheets 동시 저장
   - 실패 시 LocalStorage만 사용 (오프라인 모드)

4. **동기화 상태 UI 추가**
   - 네비게이션 바에 동기화 상태 표시
   - 로딩 인디케이터
   - 에러 메시지 표시

5. **설정 모달 확장** (line 122-145)
   - Google Sheets Web App URL 입력 필드 추가
   - 연결 테스트 버튼

---

## 구현 단계

### Step 1: Google Sheets 준비
1. Google Sheets 새 문서 생성
2. 3개 시트 생성: `roles`, `tasks`, `principles`
3. 헤더 행 설정

### Step 2: Apps Script 작성
1. 도구 → Apps Script 메뉴 열기
2. 제공된 `Code.gs` 코드 붙여넣기
3. 배포 → 새 배포 → 웹 앱
4. 액세스 권한: "나만" 또는 "모든 사용자"
5. Web App URL 복사

### Step 3: HTML 파일 수정
1. 수정된 HTML 파일로 교체
2. 설정 모달에서 Web App URL 입력
3. "연결 테스트" 버튼으로 확인

### Step 4: 데이터 마이그레이션
1. 첫 실행 시 자동으로 LocalStorage → Sheets 이동
2. 이후 모든 변경사항은 Sheets에 저장

---

## Verification Plan

### Automated Tests
- Google Sheets 연결 테스트
- 데이터 읽기/쓰기 테스트
- 에러 핸들링 테스트

### Manual Verification
1. **다중 브라우저 테스트**
   - Chrome에서 데이터 수정
   - Edge에서 새로고침 후 변경사항 확인

2. **동시 편집 테스트**
   - 두 개의 브라우저 탭에서 동시에 열기
   - 한쪽에서 수정 후 다른 쪽에서 새로고침

3. **오프라인 모드 테스트**
   - 인터넷 연결 끊기
   - LocalStorage 캐시로 작동 확인
   - 재연결 시 동기화 확인

---

## 추가 기능 (선택사항)

- [ ] 자동 새로고침 (30초마다 Sheets에서 데이터 가져오기)
- [ ] 충돌 해결 메커니즘 (마지막 수정 시간 기준)
- [ ] 변경 이력 로그
- [ ] 오프라인 큐 (연결 복구 시 자동 동기화)
